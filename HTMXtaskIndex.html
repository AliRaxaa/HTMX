<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>HTMX Chat Room</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
	<script src="https://unpkg.com/htmx.org@1.9.2"></script>
	<style>
		.hidden {
			display: none;
		}

		.chat-box {
			height: 300px;
			overflow-y: auto;
			border: 1px solid #ccc;
			padding: 1rem;
		}
	</style>
</head>

<body>
	<div class="container my-5">
		<div class="row"></div>
		<div class="col-md-12">
			<h1 class="text-center mb-5">HTMX Chat Room</h1>
			<form id="username-form" onsubmit="return handleUsernameSubmit(event)">
				<label class="mb-0">Enter a unique username to proceed:</label>
				<input type="text" id="username" class="form-control mt-3" required />
				<button id="username-submit" class="btn btn-primary mt-3" type="submit">Continue</button>
			</form>

			<div id="create-room-section" class="hidden mt-5">
				<h5 class="mb-3">Create Chat Room</h5>
				<form onsubmit="return createRoom(event)">
					<input type="text" id="roomName" placeholder="Unique Room Name" required
						class="form-control mt-3" />
					<button class="btn btn-primary mt-3">Create Room</button>
				</form>
			</div>

			<div id="room-section" class="hidden mt-5">
				<h5 class="mb-3">Available Chat Rooms</h5>
				<ul id="room-list" class="list-group"></ul>
			</div>

			<div id="chat-room" class="hidden mt-5">
				<h5 class="mb-3" id="chat-room-name"></h5>
				<div class="chat-box mb-3" id="chat-messages"></div>
				<form onsubmit="return sendMessage(event)">
					<input id="message-input" class="form-control" placeholder="Type your message..." required />
					<button class="btn btn-success mt-3">Send</button>
				</form>
			</div>
		</div>


	</div>

	<script>
		const users = new Set();
		const rooms = [];
		const messagesByRoom = {};
		let currentUser = '';
		let currentRoom = '';

		function handleUsernameSubmit(event) {
			event.preventDefault();
			const input = document.getElementById("username");
			const username = input.value.trim();
			if (!username || users.has(username)) {
				alert("Username must be unique and not empty.");
				return false;
			}
			currentUser = username;
			users.add(username);
			input.disabled = true;
			document.getElementById("username-submit").classList.add("d-none");
			document.getElementById("create-room-section").classList.remove("hidden");
			renderRooms();
			return false;
		}

		function createRoom(event) {
			event.preventDefault();
			const name = document.getElementById("roomName").value.trim();
			if (!name || rooms.some(r => r.name === name)) {
				alert("Room name must be unique and not empty.");
				return false;
			}
			rooms.push({ name, owner: currentUser });
			messagesByRoom[name] = [];
			document.getElementById("roomName").value = '';
			renderRooms();
			return false;
		}

		function renderRooms() {
			const list = document.getElementById("room-list");
			list.innerHTML = '';
			if (rooms.length > 0) {
				document.getElementById("room-section").classList.remove("hidden");
			}
			rooms.forEach(room => {
				const item = document.createElement("li");
				item.className = "list-group-item d-flex justify-content-between align-items-center";
				item.innerHTML = `
          <span><strong>${room.name}</strong> <small class="text-muted">by ${room.owner}</small></span>
          <button class="btn btn-success" onclick="joinRoom('${room.name}')">Join</button>
        `;
				list.appendChild(item);
			});
		}

		function joinRoom(name) {
			currentRoom = name;
			document.getElementById("chat-room-name").textContent = `Room: ${name}`;
			document.getElementById("chat-room").classList.remove("hidden");
			renderMessages();
		}

		function sendMessage(event) {
			event.preventDefault();
			const input = document.getElementById("message-input");
			const msg = input.value.trim();
			if (!msg) return false;
			messagesByRoom[currentRoom].push({ user: currentUser, text: msg });
			input.value = '';
			renderMessages();
			return false;
		}

		function renderMessages() {
			const box = document.getElementById("chat-messages");
			box.innerHTML = '';
			messagesByRoom[currentRoom].forEach(({ user, text }) => {
				const line = document.createElement("div");
				line.innerHTML = `<strong>${user}:</strong> ${text}`;
				box.appendChild(line);
			});
			box.scrollTop = box.scrollHeight;
		}
	</script>
	<!-- This code is generated by AI, and some customizations are made by me-->
</body>

</html>